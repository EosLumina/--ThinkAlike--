
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.11">
    
    
      
        <title>API Endpoints - Mode 2: User Discovery & Connection - ThinkAlike Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.4af4bdda.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api-endpoints-mode-2-user-discovery-connection" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="ThinkAlike Documentation" class="md-header__button md-logo" aria-label="ThinkAlike Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ThinkAlike Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API Endpoints - Mode 2: User Discovery &amp; Connection
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="ThinkAlike Documentation" class="md-nav__button md-logo" aria-label="ThinkAlike Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    ThinkAlike Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-introduction" class="md-nav__link">
    <span class="md-ellipsis">
      1. Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-api-endpoints-mode-2-functionality" class="md-nav__link">
    <span class="md-ellipsis">
      2. API Endpoints - Mode 2 Functionality
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. API Endpoints - Mode 2 Functionality">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-user-network-discovery-profile-viewing" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 User Network Discovery &amp; Profile Viewing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-narrative-compatibility-test-management-connection-gating" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 Narrative Compatibility Test Management (Connection Gating)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-data-models" class="md-nav__link">
    <span class="md-ellipsis">
      3. Data Models
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      4. Error Handling
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="api-endpoints-mode-2-user-discovery-connection">API Endpoints - Mode 2: User Discovery &amp; Connection</h1>
<hr />
<h2 id="1-introduction">1. Introduction</h2>
<p>This document specifies the <strong>API endpoints for the ThinkAlike project backend, specifically for Mode 2 (User Discovery &amp; Connection) functionality.</strong> It supplements the main <code>API_ENDPOINTS.md</code> and details the routes, methods, request/response formats, authentication, and functionality related to <strong>user-driven browsing of potential matches (User Nodes/AI Clones), viewing detailed profiles, and initiating/managing the Narrative Compatibility Tests</strong> required before direct connections are established in this Mode.</p>
<p>Refer to <code>API_ENDPOINTS.md</code> for general API conventions, authentication details (JWT Bearer), base URL (<code>/api/v1</code>), and standard error response formats. All endpoints listed here require <strong>Bearer Authentication</strong>.</p>
<p>Mode 2 allows users to proactively explore the network based on Value Profiles and Matching Percentages, initiating connections only after successfully navigating a narrative compatibility gate.</p>
<hr />
<h2 id="2-api-endpoints-mode-2-functionality">2. API Endpoints - Mode 2 Functionality</h2>
<h3 id="21-user-network-discovery-profile-viewing">2.1 User Network Discovery &amp; Profile Viewing</h3>
<ul>
<li>
<p><code>GET /api/v1/discovery/network</code></p>
</li>
<li>
<p><strong>Purpose:</strong> Fetch potential matches (User Nodes) for the authenticated user to browse in the Mode 2 discovery interface.</p>
</li>
<li>
<p><strong>Description:</strong> Retrieves a list of other users, typically sorted or filterable by initial compatibility scores (Matching Percentage), activity, or user-defined preferences. Includes essential data to render AI Clones and profile summaries for the browsing experience.</p>
</li>
<li>
<p><strong>Method:</strong> <code>GET</code></p>
</li>
<li>
<p><strong>Authentication:</strong> Required.</p>
</li>
<li>
<p><strong>Query Parameters (Optional):</strong></p>
<ul>
<li>
<p><code>sortBy</code>: <code>string</code> (e.g., <code>matching_percentage_desc</code>, <code>last_active_desc</code>, <code>distance_asc</code>) - Sorting criteria.</p>
</li>
<li>
<p><code>filterByValue</code>: <code>string</code> (Comma-separated list of value IDs/tags).</p>
</li>
<li>
<p><code>filterByInterest</code>: <code>string</code> (Comma-separated list of interest IDs/tags).</p>
</li>
<li>
<p><code>minMatchPercentage</code>: <code>float</code> (e.g., <code>0.5</code>) - Minimum score filter.</p>
</li>
<li>
<p><code>page</code>: <code>integer</code> (Default: 1) - Pagination page number.</p>
</li>
<li>
<p><code>pageSize</code>: <code>integer</code> (Default: 20) - Results per page.</p>
</li>
</ul>
</li>
<li>
<p><strong>Responses:</strong></p>
<ul>
<li>
<p><code>200 OK</code>: Successfully retrieved a paginated list of User Nodes for discovery.</p>
<div class="highlight"><pre><span></span><code>```json
{
  &quot;users&quot;: [
    {
      &quot;userId&quot;: &quot;integer&quot;,
      &quot;username&quot;: &quot;string&quot;,
      &quot;aiCloneData&quot;: { // Essential for Mode 2 browsing view
        &quot;videoIntroUrl&quot;: &quot;string (URL of the user&#39;s short video intro)&quot;,
        &quot;styleParameters&quot;: { // AI-derived parameters for visual style
            &quot;hue&quot;: &quot;float&quot;, &quot;saturation&quot;: &quot;float&quot;, &quot;brightness&quot;: &quot;float&quot;,
            &quot;waveform_pattern&quot;: &quot;string&quot;
         },
         &quot;dominantValues&quot;: [&quot;string&quot;, &quot;...&quot;] // Values influencing style
      },
      &quot;matchingPercentage&quot;: &quot;float (Score relative to the requesting user)&quot;,
      &quot;profileSummary&quot;: { // Concise info for card view
        &quot;tagline&quot;: &quot;string (Optional)&quot;,
        &quot;keyValues&quot;: [&quot;string&quot;, &quot;...&quot;], // Top shared/prominent values
        &quot;keyInterests&quot;: [&quot;string&quot;, &quot;...&quot;] // Top shared/prominent interests
      },
      &quot;lastActive&quot;: &quot;string (date-time, optional)&quot;
    }
    // ... more user summaries
  ],
  &quot;pagination&quot;: {
    &quot;currentPage&quot;: &quot;integer&quot;,
    &quot;pageSize&quot;: &quot;integer&quot;,
    &quot;totalItems&quot;: &quot;integer&quot;,
    &quot;totalPages&quot;: &quot;integer&quot;
  },
  &quot;ui_feedback_components&quot;: {
    &quot;type&quot;: &quot;object&quot;,
    &quot;description&quot;: &quot;UI components validating successful retrieval and display of user network for discovery.&quot;
  }
}
```
</code></pre></div>
</li>
<li>
<p><code>400 Bad Request</code>: Invalid query parameter format.</p>
</li>
<li>
<p><code>401 Unauthorized</code>: Authentication required.</p>
</li>
<li>
<p><code>500 Internal Server Error</code>: Error retrieving or processing user data.</p>
</li>
</ul>
</li>
<li>
<p><code>GET /api/v1/discovery/profile/{userId}</code></p>
</li>
<li>
<p><strong>Purpose:</strong> Fetch detailed profile information for a specific user selected from the discovery network view.</p>
</li>
<li>
<p><strong>Description:</strong> Retrieves comprehensive details needed for the full profile view in Mode 2, including video intro URL, personal narrative, detailed values/interests, and the crucial <code>matchingPercentage</code> relative to the requesting user. Access respects target user's privacy settings. <em>(Consistency check needed with <code>GET /users/{userId}</code> - ensure this endpoint provides Mode 2 specific needs like <code>matchingPercentage</code> and potentially excludes sensitive data not relevant for initial discovery).</em></p>
</li>
<li>
<p><strong>Method:</strong> <code>GET</code></p>
</li>
<li>
<p><strong>Authentication:</strong> Required.</p>
</li>
<li>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>userId</code> (path parameter, integer, required): The ID of the user whose profile is being requested.</li>
</ul>
</li>
<li>
<p><strong>Responses:</strong></p>
<ul>
<li>
<p><code>200 OK</code>: Successfully retrieved detailed profile data for Mode 2 display.</p>
<div class="highlight"><pre><span></span><code>```json
{
  // Core user fields (userId, username, etc. - ensure consistency)
  &quot;userId&quot;: &quot;integer&quot;,
  &quot;username&quot;: &quot;string&quot;,
  &quot;aiCloneData&quot;: { // For displaying the clone/video on the profile page
     &quot;videoIntroUrl&quot;: &quot;string&quot;,
     &quot;styleParameters&quot;: { &quot;...&quot;:&quot;...&quot; }
  },
  &quot;matchingPercentage&quot;: &quot;float (Crucial: Score relative to the requesting user)&quot;,
  &quot;personalNarrative&quot;: {
      &quot;content&quot;: &quot;object or string&quot;, // User&#39;s self-authored narrative
      &quot;privacy&quot;: &quot;string&quot; // Reflects narrative visibility setting
   },
  &quot;values&quot;: [ /* Array of user&#39;s detailed values */ ],
  &quot;interests&quot;: [ /* Array of user&#39;s detailed interests */ ],
  &quot;sharedCommunities&quot;: [ // Optional: Shared Mode 3 communities
    { &quot;communityId&quot;: &quot;integer&quot;, &quot;communityName&quot;: &quot;string&quot; }
  ],
  &quot;bio&quot;: &quot;string (optional)&quot;,
  &quot;full_name&quot;: &quot;string (optional)&quot;, // Other relevant profile fields
  &quot;ui_feedback_components&quot;: {
    &quot;type&quot;: &quot;object&quot;,
    &quot;description&quot;: &quot;UI components validating successful retrieval of detailed profile for Mode 2.&quot;
  }
}
```
</code></pre></div>
</li>
<li>
<p><code>401 Unauthorized</code>: Authentication required.</p>
</li>
<li>
<p><code>403 Forbidden</code>: Requesting user does not have permission to view this detailed profile (privacy settings).</p>
</li>
<li>
<p><code>404 Not Found</code>: User with the specified <code>userId</code> not found.</p>
</li>
<li>
<p><code>500 Internal Server Error</code>: Error retrieving profile data.</p>
</li>
</ul>
</li>
</ul>
<h3 id="22-narrative-compatibility-test-management-connection-gating">2.2 Narrative Compatibility Test Management (Connection Gating)</h3>
<ul>
<li>
<p><code>POST /api/v1/connection/initiate_test</code></p>
</li>
<li>
<p><strong>Purpose:</strong> Initiate the Narrative Compatibility Test between the authenticated user (requester) and a target user.</p>
</li>
<li>
<p><strong>Description:</strong> Triggered when the requester clicks "Connect" on a target user's profile in Mode 2. The backend checks eligibility (not already connected, not blocked, no recent failed test) and starts a new test session, returning the first narrative step. This acts as the gate before direct communication.</p>
</li>
<li>
<p><strong>Method:</strong> <code>POST</code></p>
</li>
<li>
<p><strong>Authentication:</strong> Required.</p>
</li>
<li>
<p><strong>Request Body (JSON):</strong></p>
<div class="highlight"><pre><span></span><code>```json
{
  &quot;targetUserId&quot;: &quot;integer (Required, the ID of the user the requester wants to connect with)&quot;
}
```
</code></pre></div>
</li>
<li>
<p><strong>Responses:</strong></p>
<ul>
<li>
<p><code>201 Created</code>: Test session initiated successfully. Returns the starting narrative node for the requester.</p>
<div class="highlight"><pre><span></span><code>```json
{
  &quot;message&quot;: &quot;Narrative Compatibility Test initiated.&quot;,
  &quot;testSessionId&quot;: &quot;string (Unique ID for this specific test instance between users)&quot;,
  &quot;narrativeNode&quot;: { // The first step of the compatibility narrative
    &quot;nodeId&quot;: &quot;string&quot;,
    &quot;nodeType&quot;: &quot;string (e.g., &#39;prompt&#39;, &#39;scene_description&#39;)&quot;,
    &quot;content&quot;: { &quot;text&quot;: &quot;string&quot;, &quot;imageUrl&quot;: &quot;string (optional)&quot; },
    &quot;choices&quot;: [ { &quot;choiceId&quot;: &quot;string&quot;, &quot;text&quot;: &quot;string&quot; } ] // Starting choices
  },
  &quot;ui_feedback_components&quot;: {
    &quot;type&quot;: &quot;object&quot;,
    &quot;description&quot;: &quot;UI components validating successful test initiation.&quot;
  }
}
```
</code></pre></div>
</li>
<li>
<p><code>400 Bad Request</code>: Cannot initiate test (e.g., already connected, test in progress, requester/target ineligible).</p>
</li>
<li>
<p><code>401 Unauthorized</code>: Authentication required.</p>
</li>
<li>
<p><code>403 Forbidden</code>: Requesting user is blocked by the target user, or other permission issue.</p>
</li>
<li>
<p><code>404 Not Found</code>: Target user <code>targetUserId</code> not found.</p>
</li>
<li>
<p><code>409 Conflict</code>: A test between these users is already active or recently failed.</p>
</li>
<li>
<p><code>500 Internal Server Error</code>: Error setting up the test session or generating the narrative.</p>
</li>
</ul>
</li>
<li>
<p><code>POST /api/v1/connection/test/choice</code></p>
</li>
<li>
<p><strong>Purpose:</strong> Submit the user's choice within an ongoing Narrative Compatibility Test and get the next step or final outcome.</p>
</li>
<li>
<p><strong>Description:</strong> The user provides their choice for the current narrative step within the test session. The backend (likely involving the AI Narrative Engine) processes this choice, potentially updates an internal compatibility score for the test, and determines the next narrative node or the final outcome of the test (connection enabled or denied).</p>
</li>
<li>
<p><strong>Method:</strong> <code>POST</code></p>
</li>
<li>
<p><strong>Authentication:</strong> Required.</p>
</li>
<li>
<p><strong>Request Body (JSON):</strong></p>
<div class="highlight"><pre><span></span><code>```json
{
  &quot;testSessionId&quot;: &quot;string (Required, identifier for the test instance)&quot;,
  &quot;currentNodeId&quot;: &quot;string (Required, ID of the node the user is responding to)&quot;,
  &quot;chosenChoiceId&quot;: &quot;string (Required, ID of the choice the user selected)&quot;
}
```
</code></pre></div>
</li>
<li>
<p><strong>Responses:</strong></p>
<ul>
<li>
<p><code>200 OK</code>: Choice processed. Returns either the next narrative node or the final outcome.</p>
<div class="highlight"><pre><span></span><code>```json
{
  &quot;narrativeNode&quot;: { // EITHER this is present...
    &quot;nodeId&quot;: &quot;string&quot;,
    &quot;nodeType&quot;: &quot;string&quot;,
    &quot;content&quot;: { &quot;...&quot;: &quot;...&quot; },
    &quot;choices&quot;: [ /* ... */ ],
    &quot;isEnding&quot;: &quot;boolean (false)&quot;
  },
  &quot;testOutcome&quot;: null, // ...OR narrativeNode is null and testOutcome is present
  &quot;ui_feedback_components&quot;: {
    &quot;type&quot;: &quot;object&quot;,
    &quot;description&quot;: &quot;UI components validating choice processing.&quot;
  }
}
```

*OR (if the test concludes)*

```json
{
  &quot;narrativeNode&quot;: null, // Test ended
  &quot;testOutcome&quot;: { // FINAL result
    &quot;status&quot;: &quot;string (Enum: &#39;connection_enabled&#39;, &#39;connection_denied&#39;)&quot;, // Outcome based on compatibility score threshold reached during test
    &quot;finalMatchingPercentage&quot;: &quot;float (Optional, the score calculated during the test)&quot;,
    &quot;reason&quot;: &quot;string (Optional, user-friendly reason if denied, e.g., &#39;Value alignment threshold not met during narrative.&#39;)&quot;,
    &quot;message&quot;: &quot;string (User-facing message for the outcome)&quot;
  },
  &quot;ui_feedback_components&quot;: {
    &quot;type&quot;: &quot;object&quot;,
    &quot;description&quot;: &quot;UI components validating the final test outcome.&quot;
  }
}
```
</code></pre></div>
</li>
<li>
<p><code>400 Bad Request</code>: Invalid input (<code>testSessionId</code>, <code>currentNodeId</code>, <code>chosenChoiceId</code>).</p>
</li>
<li>
<p><code>401 Unauthorized</code>: Authentication required.</p>
</li>
<li>
<p><code>404 Not Found</code>: <code>testSessionId</code> or <code>currentNodeId</code> not found.</p>
</li>
<li>
<p><code>409 Conflict</code>: Test session already completed or state mismatch (e.g., wrong user trying to submit choice).</p>
</li>
<li>
<p><code>500 Internal Server Error</code>: Error processing choice or determining outcome.</p>
</li>
</ul>
</li>
</ul>
<p><em>(Endpoints for managing established connections themselves, like listing connections (<code>GET /connections</code>) or removing them (<code>DELETE /connections/{connectionId}</code>), would likely reside under a general <code>/connections</code> resource defined in the main <code>api_endpoints.md</code>, as they apply regardless of how the connection was formed).</em></p>
<hr />
<h2 id="3-data-models">3. Data Models</h2>
<ul>
<li>
<p><strong><code>UserNodeSummaryMode2</code></strong>: Data for discovery view (<code>userId</code>, <code>username</code>, <code>aiCloneData</code>, <code>matchingPercentage</code>, <code>profileSummary</code>). See <code>GET /discovery/network</code>.</p>
</li>
<li>
<p><strong><code>AICloneData</code></strong>: Visual representation data (<code>videoIntroUrl</code>, <code>styleParameters</code>).</p>
</li>
<li>
<p><strong><code>DetailedUserProfileMode2</code></strong>: Profile data for detail view (<code>userId</code>, <code>username</code>, <code>aiCloneData</code>, <code>matchingPercentage</code>, <code>personalNarrative</code>, values, interests, etc.). See <code>GET /discovery/profile/{userId}</code>.</p>
</li>
<li>
<p><strong><code>NarrativeCompatibilityTestSession</code></strong>: Backend state for an ongoing test (<code>testSessionId</code>, user IDs, current node, score, history).</p>
</li>
<li>
<p><strong><code>NarrativeNode</code> / <code>NarrativeChoice</code> (Compatibility Test Variant)</strong>: Structure similar to Mode 1 nodes/choices, but content tailored for assessing compatibility between two specific users.</p>
</li>
<li>
<p><strong><code>TestOutcome</code></strong>: Final result of the compatibility test (<code>status</code>, <code>finalMatchingPercentage</code>, <code>reason</code>, <code>message</code>). See <code>POST /connection/test/choice</code> response.</p>
</li>
</ul>
<p><em>(Refer to the Mode 2 Spec (<code>mode2_profile_discovery_spec.md</code>) and shared data models for detailed definitions).</em></p>
<hr />
<h2 id="4-error-handling">4. Error Handling</h2>
<p>Standard HTTP errors apply. Pay attention to:</p>
<ul>
<li>
<p><code>403 Forbidden</code> for privacy/blocking issues,</p>
</li>
<li>
<p><code>404 Not Found</code> for missing users or sessions, and</p>
</li>
<li>
<p><code>409 Conflict</code> for invalid test states.</p>
</li>
</ul>
<p>Error bodies include a <code>message</code> field and may also contain <code>ui_validation_components</code> for UI feedback.</p>
<hr />
<hr />
<p><strong>Document Details</strong></p>
<ul>
<li>
<p>Title: API Endpoints - Mode 2: User Discovery &amp; Connection</p>
</li>
<li>
<p>Type: API Documentation</p>
</li>
<li>
<p>Version: 1.0.0</p>
</li>
<li>
<p>Last Updated: 2025-04-05</p>
</li>
</ul>
<hr />
<p>End of API Endpoints - Mode 2: User Discovery &amp; Connection</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>