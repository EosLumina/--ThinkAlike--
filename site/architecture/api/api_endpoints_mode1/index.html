
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for the ThinkAlike project">
      
      
      
        <link rel="canonical" href="https://eoslumina.github.io/--ThinkAlike--/architecture/api/api_endpoints_mode1/">
      
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.11">
    
    
      
        <title>API Endpoints - Mode 1: Narrative Onboarding & Match Reveal - ThinkAlike Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="amber">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api-endpoints-mode-1-narrative-onboarding-match-reveal" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="ThinkAlike Documentation" class="md-header__button md-logo" aria-label="ThinkAlike Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ThinkAlike Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API Endpoints - Mode 1: Narrative Onboarding &amp; Match Reveal
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../index.md" class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../core/enlightenment_2_0/enlightenment_2_0_principles/" class="md-tabs__link">
          
  
  
  Core

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../vision/core_concepts/" class="md-tabs__link">
          
  
  
  Vision

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../architectural_overview/" class="md-tabs__link">
          
  
  
  Architecture

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../guides/developer_guides/code_style_guide/" class="md-tabs__link">
          
  
  
  Development

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../guides/devops/devops_workflow.md" class="md-tabs__link">
          
  
  
  DevOps

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="ThinkAlike Documentation" class="md-nav__button md-logo" aria-label="ThinkAlike Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    ThinkAlike Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../index.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Core
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Core
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/enlightenment_2_0/enlightenment_2_0_principles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Enlightenment 2.0 Principles
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/ethics/ethical_guidelines/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ethical Guidelines
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/onboarding_guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Onboarding Guide
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Vision
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Vision
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../vision/core_concepts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Core Concepts Explained
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../vision/blockchain_integration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Blockchain Integration
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architectural_overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Architectural Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api_endpoints_mode2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Endpoints (Mode 2)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Development
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Development
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/developer_guides/code_style_guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Code Style Guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/developer_guides/building_backend_endpoint/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Building Backend Endpoint Guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/developer_guides/building_ui_component/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Building UI Component Guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/developer_guides/ui_validation_examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    UI Validation Examples
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/developer_guides/git_workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Git Workflow Standard
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/development/github_actions_workflow_format.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GitHub Actions Workflow Format
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    DevOps
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            DevOps
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/devops/devops_workflow.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DevOps Workflow Guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/devops/ci_cd_workflow_reference.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CI/CD Workflow Reference
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-introduction" class="md-nav__link">
    <span class="md-ellipsis">
      1. Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-api-endpoints-mode-1-functionality" class="md-nav__link">
    <span class="md-ellipsis">
      2. API Endpoints - Mode 1 Functionality
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. API Endpoints - Mode 1 Functionality">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-narrative-flow-management" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 Narrative Flow Management
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-data-models" class="md-nav__link">
    <span class="md-ellipsis">
      3. Data Models
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      4. Error Handling
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-key-considerations-for-mode-1-api" class="md-nav__link">
    <span class="md-ellipsis">
      5. Key Considerations for Mode 1 API
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="api-endpoints-mode-1-narrative-onboarding-match-reveal">API Endpoints - Mode 1: Narrative Onboarding &amp; Match Reveal<a class="headerlink" href="#api-endpoints-mode-1-narrative-onboarding-match-reveal" title="Permanent link">&para;</a></h1>
<hr />
<h2 id="1-introduction">1. Introduction<a class="headerlink" href="#1-introduction" title="Permanent link">&para;</a></h2>
<p>This document specifies the <strong>API endpoints for the ThinkAlike project backend, specifically for Mode 1 (Narrative Onboarding &amp; Match Reveal) functionality.</strong> It supplements the main <code>API_ENDPOINTS.md</code> and details the routes, methods, request/response formats, authentication, and functionality required to drive the interactive "Whispering Woods" choose-your-own-adventure experience. This mode serves as the primary onboarding mechanism, introduces core project values, elicits initial user Value Profile data, and culminates in a potential AI-driven "perfect match" reveal.</p>
<p>Refer to <a href="../api_endpoints/"><code>API_ENDPOINTS.md</code></a> for general API conventions, authentication details (JWT Bearer), base URL (<code>/api/v1</code>), and standard error response formats. All endpoints listed here require <strong>Bearer Authentication</strong>.</p>
<p>These endpoints facilitate the stateful progression through the narrative, interaction with the AI Narrative Engine, and the final match reveal based on the user's choices.</p>
<hr />
<h2 id="2-api-endpoints-mode-1-functionality">2. API Endpoints - Mode 1 Functionality<a class="headerlink" href="#2-api-endpoints-mode-1-functionality" title="Permanent link">&para;</a></h2>
<h3 id="21-narrative-flow-management">2.1 Narrative Flow Management<a class="headerlink" href="#21-narrative-flow-management" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><code>GET /api/v1/narrative/start</code></p>
</li>
<li>
<p><strong>Purpose:</strong> Initiate a new Mode 1 narrative ("Whispering Woods") or resume an existing session for the authenticated user.</p>
</li>
<li>
<p><strong>Description:</strong> Retrieves the starting narrative node (scene description, initial prompt, first choices) for a user beginning Mode 1, or fetches their last saved position if they left mid-adventure. This is the entry point for the Mode 1 experience.</p>
</li>
<li>
<p><strong>Method:</strong> <code>GET</code></p>
</li>
<li>
<p><strong>Authentication:</strong> Required.</p>
</li>
<li>
<p><strong>Responses:</strong></p>
<ul>
<li>
<p><code>200 OK</code>: Successfully retrieved the starting or current narrative state.</p>
<div class="highlight"><pre><span></span><code>```json
{
  &quot;narrativeNode&quot;: { // The current step/scene data
    &quot;nodeId&quot;: &quot;string (Unique ID for this narrative step/scene, e.g., &#39;ww_intro_1&#39;)&quot;,
    &quot;nodeType&quot;: &quot;string (Enum: &#39;prompt&#39;, &#39;scene_description&#39;, &#39;choice_point&#39;, &#39;match_reveal&#39;, &#39;narrative_end&#39;)&quot;,
    &quot;content&quot;: {
      &quot;text&quot;: &quot;string (Narrative text, AI agent dialogue, question)&quot;,
      &quot;imageUrl&quot;: &quot;string (Optional URL for background/scene image)&quot;,
      &quot;audioUrl&quot;: &quot;string (Optional URL for ambient sound/narration)&quot;
    },
    &quot;choices&quot;: [ // Array of choices if nodeType is &#39;choice_point&#39;
      {
        &quot;choiceId&quot;: &quot;string (Unique ID for this choice, e.g., &#39;ww_intro_1_choice_a&#39;)&quot;,
        &quot;text&quot;: &quot;string (Text displayed for the user&#39;s choice option)&quot;
        // &quot;value_implication&quot; field removed - backend infers value from choiceId
      }
      // ... more choices
    ],
    &quot;isEnding&quot;: &quot;boolean (True if this node represents an end state of the narrative flow)&quot;,
    &quot;matchData&quot;: null // Typically null unless nodeType is &#39;match_reveal&#39;
  },
  &quot;sessionState&quot;: { // Identifier for the current narrative session/state
      &quot;sessionId&quot;: &quot;string (Unique ID for this specific narrative playthrough)&quot;,
      &quot;progressPercentage&quot;: &quot;float (Estimate of narrative completion, 0.0 to 1.0)&quot; // Optional
  },
  &quot;ui_feedback_components&quot;: {
       &quot;type&quot;: &quot;object&quot;,
       &quot;description&quot;: &quot;UI components confirming successful narrative state retrieval.&quot;
  }
}
```
</code></pre></div>
</li>
<li>
<p><code>401 Unauthorized</code>: Authentication required.</p>
</li>
<li>
<p><code>404 Not Found</code>: Narrative definition unavailable or user state error.</p>
</li>
<li>
<p><code>500 Internal Server Error</code>: Backend or AI Narrative Engine error retrieving state.</p>
</li>
</ul>
</li>
<li>
<p><code>POST /api/v1/narrative/choice</code></p>
</li>
<li>
<p><strong>Purpose:</strong> Submit the user's selected choice for the current narrative step and retrieve the subsequent step or outcome.</p>
</li>
<li>
<p><strong>Description:</strong> The core interaction endpoint for Mode 1. The frontend sends the <code>choiceId</code> selected by the user for the <code>currentNodeId</code> within the active <code>sessionId</code>. The backend interacts with the AI Narrative Engine and the matching logic to determine the next narrative state (including potential updates to the user's implicit Value Profile) and returns the corresponding <code>narrativeNode</code>. This endpoint drives the story forward and the underlying matching calculation.</p>
</li>
<li>
<p><strong>Method:</strong> <code>POST</code></p>
</li>
<li>
<p><strong>Authentication:</strong> Required.</p>
</li>
<li>
<p><strong>Request Body (JSON):</strong></p>
<div class="highlight"><pre><span></span><code>```json
{
  &quot;sessionId&quot;: &quot;string (Required, identifier for the ongoing narrative playthrough)&quot;,
  &quot;currentNodeId&quot;: &quot;string (Required, ID of the node the user just responded to)&quot;,
  &quot;chosenChoiceId&quot;: &quot;string (Required, ID of the choice the user selected)&quot;
}
```
</code></pre></div>
</li>
<li>
<p><strong>Responses:</strong></p>
<ul>
<li>
<p><code>200 OK</code>: Choice successfully processed. Returns the next narrative state, which might be another step or the final match reveal.</p>
<div class="highlight"><pre><span></span><code>```json
// --- If narrative continues ---
{
  &quot;narrativeNode&quot;: { // The *next* step in the narrative
    &quot;nodeId&quot;: &quot;string&quot;,
    &quot;nodeType&quot;: &quot;string (e.g., &#39;prompt&#39;, &#39;choice_point&#39;)&quot;,
    &quot;content&quot;: { &quot;...&quot;: &quot;...&quot; },
    &quot;choices&quot;: [ /* ... */ ], // If applicable
    &quot;isEnding&quot;: &quot;boolean (false)&quot;,
    &quot;matchData&quot;: null
  },
  &quot;sessionState&quot;: { // Updated session state
      &quot;sessionId&quot;: &quot;string&quot;,
      &quot;progressPercentage&quot;: &quot;float&quot;
  },
  &quot;ui_feedback_components&quot;: {
       &quot;type&quot;: &quot;object&quot;,
       &quot;description&quot;: &quot;UI components validating successful choice processing.&quot;
  }
}
// --- If narrative ends with MATCH REVEAL ---
{
  &quot;narrativeNode&quot;: {
    &quot;nodeId&quot;: &quot;string (e.g., &#39;ww_match_reveal&#39;)&quot;,
    &quot;nodeType&quot;: &quot;string (&#39;match_reveal&#39;)&quot;,
    &quot;content&quot;: {
        &quot;text&quot;: &quot;string (Narrative text revealing the match, e.g., &#39;Through the clearing, you see a figure whose values resonate strongly with yours...&#39;)&quot;,
        &quot;imageUrl&quot;: &quot;string (Optional image)&quot;
     },
    &quot;choices&quot;: [], // No further choices at this point
    &quot;isEnding&quot;: &quot;boolean (true)&quot;,
    &quot;matchData&quot;: { // Details of the revealed match
        &quot;matchedUserId&quot;: &quot;integer&quot;,
        &quot;matchingPercentage&quot;: &quot;float (The final calculated score)&quot;,
        &quot;keySharedValues&quot;: [&quot;string&quot;, &quot;...&quot;], // Highlighted shared values
        &quot;aiCloneData&quot;: { // Data to render the AI Clone of the match
            &quot;videoIntroUrl&quot;: &quot;string&quot;,
            &quot;styleParameters&quot;: {}
        },
        &quot;connectionUnlocked&quot;: &quot;boolean (True if direct connection is now enabled)&quot;
    }
  },
  &quot;sessionState&quot;: { // Final session state
      &quot;sessionId&quot;: &quot;string&quot;,
      &quot;progressPercentage&quot;: 1.0
  },
  &quot;ui_feedback_components&quot;: {
       &quot;type&quot;: &quot;object&quot;,
       &quot;description&quot;: &quot;UI components validating the successful match reveal.&quot;
  }
}
// --- If narrative ends WITHOUT a sufficient match ---
{
  &quot;narrativeNode&quot;: {
    &quot;nodeId&quot;: &quot;string (e.g., &#39;ww_end_no_match&#39;)&quot;,
    &quot;nodeType&quot;: &quot;string (&#39;narrative_end&#39;)&quot;,
    &quot;content&quot;: {
      &quot;text&quot;: &quot;string (Concluding text, e.g., &#39;Your journey through the woods concludes for now. Continue exploring connections in Mode 2.&#39;)&quot;
    },
    &quot;choices&quot;: [],
    &quot;isEnding&quot;: &quot;boolean (true)&quot;,
    &quot;matchData&quot;: null
  },
  &quot;sessionState&quot;: { // Final session state
      &quot;sessionId&quot;: &quot;string&quot;,
      &quot;progressPercentage&quot;: 1.0
  },
  &quot;ui_feedback_components&quot;: {
     &quot;type&quot;: &quot;object&quot;,
     &quot;description&quot;: &quot;UI components indicating narrative completion without immediate match.&quot;
  }
}
```
</code></pre></div>
</li>
<li>
<p><code>400 Bad Request</code>: Invalid input (e.g., invalid <code>chosenChoiceId</code> for <code>currentNodeId</code>, invalid <code>sessionId</code>).</p>
<div class="highlight"><pre><span></span><code>```json
 {
   &quot;message&quot;: &quot;Invalid choice or session state for narrative progression.&quot;,
   &quot;ui_validation_components&quot;: {
      &quot;type&quot;: &quot;object&quot;,
      &quot;description&quot;: &quot;UI components providing feedback on invalid input.&quot;
   }
 }
```
</code></pre></div>
</li>
<li>
<p><code>401 Unauthorized</code>: Authentication required.</p>
</li>
<li>
<p><code>404 Not Found</code>: Narrative definition error (<code>currentNodeId</code> has no path for <code>chosenChoiceId</code>).</p>
</li>
<li>
<p><code>409 Conflict</code>: Invalid session state or sequence error.</p>
</li>
<li>
<p><code>500 Internal Server Error</code>: Error in backend logic, AI Narrative Engine, or matching calculation during choice processing.</p>
</li>
</ul>
</li>
</ul>
<hr />
<h2 id="3-data-models">3. Data Models<a class="headerlink" href="#3-data-models" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p><strong><code>NarrativeNode</code></strong>: Represents a single step/scene in the Mode 1 interactive narrative. Key fields: <code>nodeId</code>, <code>nodeType</code>, <code>content</code>, <code>choices</code>, <code>isEnding</code>, <code>matchData</code>. See structure in <code>GET /start</code> response. Note <code>matchData</code> is populated only on the final reveal node.</p>
</li>
<li>
<p><strong><code>NarrativeChoice</code></strong>: Represents a selectable option within a <code>choice_point</code> node. Key fields: <code>choiceId</code>, <code>text</code>. The associated <em>value implication</em> is handled by the backend logic/AI based on the <code>choiceId</code>.</p>
</li>
<li>
<p><strong><code>NarrativeSessionState</code></strong>: Contains identifiers (<code>sessionId</code>) and potentially progress indicators needed to maintain the user's state through the narrative flow.</p>
</li>
<li>
<p><strong><code>MatchRevealData</code></strong>: Structure containing details of the revealed "perfect match" if the narrative path and matching score threshold are met. Key fields: <code>matchedUserId</code>, <code>matchingPercentage</code>, <code>keySharedValues</code>, <code>aiCloneData</code>, <code>connectionUnlocked</code>.</p>
</li>
</ul>
<p><em>(Refer to the Mode 1 Spec (<code>mode1_narrative_onboarding_spec.md</code>) for more detailed conceptual data models if needed)</em>.</p>
<hr />
<h2 id="4-error-handling">4. Error Handling<a class="headerlink" href="#4-error-handling" title="Permanent link">&para;</a></h2>
<p>Standard HTTP error codes (400, 401, 404, 409, 500) are used. Error responses should follow the standard format including <code>message</code> and potentially <code>ui_validation_components</code>. <code>409 Conflict</code> might indicate trying to submit a choice for an already completed session.</p>
<hr />
<h2 id="5-key-considerations-for-mode-1-api">5. Key Considerations for Mode 1 API<a class="headerlink" href="#5-key-considerations-for-mode-1-api" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p><strong>State Management:</strong> The backend needs robust state management for each user's <code>NarrativeSessionState</code>.</p>
</li>
<li>
<p><strong>AI Integration:</strong> Endpoints need to efficiently interact with the AI Narrative Engine to get subsequent nodes based on choices and potentially update the underlying (implicit) Value Profile used by the matching algorithm.</p>
</li>
<li>
<p><strong>Matching Logic Trigger:</strong> The logic determining if/when the <code>match_reveal</code> node is returned (based on accumulated choices and matching score) resides in the backend, triggered during the processing of <code>POST /narrative/choice</code>.</p>
</li>
<li>
<p><strong>Idempotency:</strong> Consider if <code>POST /narrative/choice</code> needs to be idempotent in case of network retries (though typically advancing state isn't idempotent). Session state management should handle potential replays gracefully.</p>
</li>
</ul>
<hr />
<hr />
<p><strong>Document Details</strong></p>
<ul>
<li>
<p>Title: API Endpoints - Mode 1: Narrative Onboarding &amp; Match Reveal</p>
</li>
<li>
<p>Type: API Documentation</p>
</li>
<li>
<p>Version: 1.0.0</p>
</li>
<li>
<p>Last Updated: 2025-04-05</p>
</li>
</ul>
<hr />
<p>End of API Endpoints - Mode 1: Narrative Onboarding &amp; Match Reveal</p>
<hr />
<p>````markdown</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.instant", "navigation.tracking", "navigation.sections", "navigation.tabs"], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>